---
- name: Retrieve the vulnerabilities of the coreos/dnsmasq:latest image
  herve4m.quay.quay_vulnerability_info:
    image: coreos/dnsmasq:latest
    quay_host: quay.io
  register: vulns1

- debug:
    var: vulns1

- name: Retrieve the vulnerabilities of the coreos/dnsmasq image (default tag)
  herve4m.quay.quay_vulnerability_info:
    image: coreos/dnsmasq
    quay_host: quay.io
  register: vulns2

- name: Ensure the two images are the same
  assert:
    that: vulns1['vulnerabilities']|length == vulns1['vulnerabilities']|length
    fail_msg: The same image should have been returned

- name: Retrieve an image with no namespace (error)
  herve4m.quay.quay_vulnerability_info:
    image: nosuchimageipresume
    quay_host: quay.io
  ignore_errors: true
  register: result

- name: Ensure the task has failed
  assert:
    that: result['failed']
    fail_msg: The preceding task should have failed

- name: Retrieve a non-existing image in my namespace
  herve4m.quay.quay_vulnerability_info:
    image: dnsmasq:v1.0.0
    quay_host: "{{ quay_url }}"
    quay_token: "{{ quay_token }}"
    validate_certs: false
  register: vulns

- name: Ensure that the task did not return vulnerabilities
  assert:
    that: vulns['vulnerabilities']|length == 0
    fail_msg: The preceding task should not have returned vulnerabilities
...
